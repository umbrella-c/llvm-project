project:
  summary: C++ SDK for Vali
  description: |
    The base SDK and runtime for the C++ language. It is required to build any C++ applications
    against the MollenOS/Vali operating system.
  author: Philip Meulengracht
  email: the_meulengracht@hotmail.com
  version: 1.0.0
  license: LGPL
  homepage: www.mollenos.com

ingredients:
- name: vali/clang-cc
  channel: devel
  platform: host
  arch: host
- name: vali/sdk-c
  channel: devel
- name: vali/zlib
  channel: devel

# There are a number of keywords that can be used in the recipe
# steps during generate, build, install and package.
recipes:
  - name: llvm-projects
    path: llvm
    toolchain: vali/clang-cc
    steps:
    - name: config
      type: generate
      system: cmake
      arguments:
        - -G
        - '"Unix Makefiles"'
        - -DLLVM_ENABLE_PROJECTS='libcxx;libcxxabi;libunwind'
        - -DCMAKE_BUILD_TYPE=Release
        - -DLLVM_INCLUDE_TESTS=OFF
        - -DLLVM_INCLUDE_EXAMPLES=OFF
        - -DLLVM_INCLUDE_BENCHMARKS=OFF
        - -DLLVM_BOOTSTRAP_RUNTIME=ON
        - -DLLVM_ENABLE_DUMP=ON
        - -DLLVM_TARGETS_TO_BUILD='X86'
        - -DLLVM_DEFAULT_TARGET_TRIPLE=${{ CHEF_TARGET_ARCHITECTURE }}-uml-vali
        - -DLLVM_ENABLE_LIBCXX=ON
        - -DLIBCXXABI_USE_LLVM_UNWINDER=ON
        - -DLIBCXX_CXX_ABI='libcxxabi'
        - -DCMAKE_TOOLCHAIN_FILE=${{ PROJECT_PATH }}/llvm/cmake/platforms/Vali.cmake
      env:
        CROSS: ${{ TOOLCHAIN_PREFIX }}/usr/local
        VALI_ARCH: ${{ CHEF_TARGET_ARCHITECTURE }}
        VALI_SDK_PATH: ${{ INGREDIENTS_PREFIX }}
        LIBCXX_BOOTSTRAP: true
    - name: build
      type: build
      depends: [config]
      system: make
      env:
        VALI_SDK_PATH: ${{ INGREDIENTS_PREFIX }}

packs:
- name: sdk-cpp
  type: ingredient
  filters:
    - bin/c++*
    - bin/unwind*
    - include/c++
    - lib/c++*
    - lib/unwind*
- name: libllvm
  type: ingredient
  filters:
    - include/llvm*
    - lib/LLVM*
